#include "runtime_utils.h"
#include "system_utils.h"

#include <stdio.h>
#include <stdlib.h>
#include <dirent.h>
#include <string.h>
#include <sys/stat.h>
#include <errno.h>


Result count_entries_in_dir(const char *path) {
    DIR *dir = opendir(path);
    if (!dir) {
        return err("Failed to open directory");
    }

    int count = 0;
    struct dirent *entry;
    while ((entry = readdir(dir)) != NULL) {
        if (strcmp(entry->d_name, ".") != 0 && strcmp(entry->d_name, "..") != 0) {
            count++;
        }
    }

    closedir(dir);
    return ok(def_int(count), "Directory entries counted");
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


Result move_dir(const char *source, const char *destination) {
    if (rename(source, destination) != 0) {
        return err(strerror(errno));
    }
    return ok(NULL, "Directory moved successfully");
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


Result delete_dir(const char *path) {
    if (rmdir(path) != 0) {
        return err(strerror(errno));
    }
    return ok(NULL, "Directory deleted successfully");
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


Result delete_file(const char *path) {
    if (remove(path) != 0) {
        return err(strerror(errno));
    }
    return ok(NULL, "File deleted successfully");
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

Result create_dir(const char *path) {
    if (mkdir(path) != 0) {
        return err(strerror(errno));
    }
    return ok(NULL, "Directory created successfully");
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

Result create_file(const char *path) {
    FILE *file = fopen(path, "w");
    if (file == NULL) {
        return err(strerror(errno));
    }
    fclose(file);
    return ok(NULL, "File created successfully");
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

Result rename_file(const char *old_path, const char *new_path) {
    if (rename(old_path, new_path) != 0) {
        return err(strerror(errno));
    }
    return ok(NULL, "File renamed successfully");
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


